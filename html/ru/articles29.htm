<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML><HEAD><TITLE>Введение в скриптинг.</TITLE>
<link rel="stylesheet" type="text/css" href="../../style/style.css">
<META http-equiv=Content-Type content="text/html; charset=windows-1251">

</HEAD>
<BODY topMargin=0 >
<TABLE
style="BORDER-RIGHT: medium none; BORDER-TOP: medium none; BORDER-LEFT: medium none; BORDER-BOTTOM: #c0c0c0 1px solid"
height=121 cellSpacing=0 cellPadding=0 width=640>
  <TBODY>
  <TR>
    <TD vAlign=top width="100%"><IMG
      src="img/ru/logo2.jpg" width="640" height="121" border=0 class="conthdr" ></TD>
</TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=640 border=0>
  <TBODY>

  <TD width="100%" height="100%" vAlign=top>
   <DIV><IMG
      src="img/ru/old/articles/articles.png" width="640" height="33"></DIV>


      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=36
            src="img/ru/mtdl.png" width=5></TD>
          <TD class=ntitle vAlign=top
          background="mtdbg.png" height=36><p>Введение в скриптинг</p></TD>
          <TD width=5><IMG height=36
            src="img/ru/mtdr.png"
      width=20></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5 background="ltd.gif"></TD>

          <TD class=news vAlign=top><p>Данная статья предназначена для тех, кто в первый раз  знакомится со скриптингом. Информация, изложенная ниже, будет полезна и тем,  кто не хочет тратить часы свободного времени для того, чтобы только добавить  новый скрипт.</p>
          <p>Итак, скрипты GTA хранятся в нескольких файлах. Б<em>о</em>льшая часть игровой логики заложена в  исполняемом файле (.exe)  и неразрывно связана с игровым процессом. Скриптеры работают со скриптами,  хранящимися в файле main.scm.</p>
          <p>Main.scm представляет  собой бинарный файл, в котором хранятся скомпилированные скрипты. Это означает,  что вы не можете открыть этот файл в текстовом редакторе и начать его  редактировать. Для изменения таких скриптов вам понадобится специальная  программа. Одной из таких является Sanny Builder (SB).  Он позволяет переводить скомпилированные скрипты в текст (этот процесс  именуется <em>декомпиляцией</em>). Полученный  текст (исходник) может легко быть изменен. Но для того чтобы изменения вступили  в силу, исходник нужно собрать обратно в main.scm (этот процесс именуется <em>компиляцией</em>).  Таким образом, процесс скриптинга условно можно изобразить в виде следующей  схемы:</p>
          <p class="general1-reservedword">main.scm-&gt;декомпиляция-&gt;изменение  исходника-&gt;компиляция-&gt;main.scm</p>
          <p>Процессом декомпиляции и компиляции занимается Sanny Builder. Для декомпиляции  файла main.scm вам  нужно открыть его нажатием F5,  для компиляции исходника нужно нажать F7. Скриптер занимается лишь редактированием исходника.</p>
          <p>Предположим, вам нужно добавить в игру новый скрипт, который  был опубликован в Интернете в виде исходника. Обычно такие скрипты выполнены в  виде отдельного потока. На данном этапе мы не будем разбирать, что такое поток.  Я просто опишу последовательность действий, которые нужно выполнить на примере  мода <a href="http://sannybuilder.com/forums/viewtopic.php?id=37" target="_blank">«Ограничитель скорости»</a></p>
          <p>Запустите Sanny Builder.  Зайдите в Настройки, нажав кнопку F10. Если вы плохо понимаете английский язык, можно переключить  язык интерфейса на русский, выбрав его в списке. Поскольку вы новичок, то  можете включить опцию ‘Использовать опкоды’. Вам нужно также указать папку, в  которой установлена игра. <br>
          <img src="img/ru/genaral01.gif" width="219" height="52"><br>
            Нажмите кнопку с тремя точками и укажите путь к игре. После  этого закройте Настройки, нажав OK. <br>
            На данном этапе рекомендуется перезапустить SB, чтобы были загружены  необходимые файлы игры.<br>
            Более подробное описание всех настроек можно прочитать <a href="O_101.htm">здесь</a>.</p>
          <p>Теперь декомпилируйте имеющийся у вас main.scm. Он хранится в папке data в директории игры. Нажмите F5 в SB и выберите  этот файл. В нижней части окна будет отображаться процесс декомпиляции. Если  все прошло успешно, перед вами появится окошко с отчетом. Если вы не хотите,  чтобы это окошко появлялось – отключите его в настройках.<br>
            Если в ходе декомпиляции возникла ошибка, постарайтесь  следовать инструкциям, которые будут показаны в сообщении ошибки. Чаще всего  ошибки возникают, если вы не указали путь к игре, либо выбрали неверный <a href="O_102.htm">режим  редактирования</a>. Оригинальный файл main.scm должен декомпилироваться без каких-либо затруднений.</p>
          <p>Итак, декомпиляция прошла и вы получили исходный файл. Он  будет автоматически сохранен в той же папке, где находится файл main.scm. Вы можете изменить адрес сохранения  и формат имени исходника в настройках программы. Не пугайтесь большого размера  файла. Со временем вы научитесь ориентироваться в нем не хуже, чем в своей собственной  квартире, если, конечно, вы в этом заинтересованы. Подробное описание  устройства исходника вы можете прочитать <a href="ERR_00ST.htm">здесь</a>.</p>
          <p>Нам нужно добавить скрипт в этот исходник. Вместе со  скриптом должен идти комментарий автора об особенностях установки. Если таких  комментариев нет, либо в начале скрипта написана команда <span class="general1-reservedword">create_thread</span>, значит вам нужно создать новый  поток. Для этого откройте поиск (<span class="general1-reservedword">Ctrl+F</span>), и  найдите слово ‘<span class="general1-reservedword">create_thread</span>’ (без кавычек). Если  вы работаете с оригинальным файлом, то эта найденная строка должна быть  примерно 948-й. Там же должны быть и другие строки, начинающийся с create_thread. Если вы не нашли такой строки  (например, если вы работаете с модифицированным файлом), попробуйте найти  строку с опкодом 0180:.</p>
          <p>После  найденной  строки добавьте новую с командой create_thread  @имя_потока. Имя потока обычно указывается в начале скрипта. Если этого  указания нет, то именем потока будет имя первой <a href="ERR_00ST.htm#Lable">метки</a> (строка,  начинающая со знака двоеточия). В нашем пример имя потока - @ogranichitel. Добавьте  строку create_thread @ogranichitel после найденной.</p>
          <p>Теперь нужно добавить сам поток (скрипт). Для этого найдите  самую первую миссию (mission  0). Там должен стоять комментарий <span class="general1-comment">//-------------Mission 0---------------</span>. Добавьте  весь (за исключением команды <span class="general1-reservedword">create_thread</span>) код скрипта перед  этим комментарием<br>
            Если вы не нашли миссию 0, попробуйте добавить скрипт в  конец файла.</p>
          <p>Итак, исходник теперь выглядит примерно так</p>
          <div class="mycode5"><span class="general1-comment">// This file was decompiled …</span><br>
            DEFINE OBJECTS<br>
            DEFINE OBJECT (noname)                <br>
            ...<br>
            0363: create_object_at …<br>
            004F: create_thread <span class="general1-label">@ODDVEH</span><br>
            <span class="general1-reservedword">create_thread</span>  <span class="general1-label">@ogranichitel</span><br>
            004F: <span class="general1-reservedword">create_thread</span> <span class="general1-label">@R3</span><br>
            …<br>
            <span class="general1-label">:MOB_GF_3609</span><br>
            00BE: text_clear_all <br>
            0051: <span class="general1-reservedword">return </span><br>
          <br>
          <span class="general1-label">:ogranichitel</span><br>
          <span class="general1-reservedword">wait</span> <span class="general1-number">5000</span><br>
          <br>
          <span class="general1-label">:ogranichitel_2</span> <br>
          <br>&lt;</strong><strong>скрипт</strong><strong>&gt;</strong><strong> </strong><br>
          <br>
          <span class="general1-reservedword">jump</span> <span class="general1-label">@ogranichitel_2</span><br>
          <br>
          <br>
          <span class="general1-comment">//-------------Mission 0---------------<br>
            // Originally: Initial 1 </span><br>
          <br>…</div>
          <p>Теперь вам осталось скомпилировать файл. Для этого нажмите F7. Если во время компиляции  возникли ошибка, следуйте ее инструкциям.<br>
            После успешной компиляции запускайте игру нажатием F8 и проверяйте скрипт в  игре.</p>
          <p>Если вам нужно добавить несколько скриптов, необязательно  каждый раз декомпилировать main.scm. Просто добавьте скрипты  в один исходный файл и скомпилируйте его.</p>

          </TD>
          <TD width=5
        background="rtd.gif"></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=20
            src="img/ru/mtdlbot.png" width=5 border=0></TD>
          <TD align=left
            background="mtdbgbot.png"></TD>
          <TD class=ninfo align=right
          background="mtdbgbot.png">&nbsp;
            </TD>
          <TD width=5><IMG height=20
            src="img/ru/mtdrbot.png" width=5
        border=0></TD></TR></TBODY></TABLE></DIV>
<BR><BR></TD></TR><td width="100%"></TBODY></TABLE>
</TABLE></body></html>
