<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML><HEAD><TITLE>Таблицы переходов</TITLE>
<link rel="stylesheet" type="text/css" href="../../style/style.css">
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
<script language="javascript" type="text/javascript" src="img/ru/clipboard.js"></script>
</HEAD>
<BODY topMargin=0 >
<TABLE
style="BORDER-RIGHT: medium none; BORDER-TOP: medium none; BORDER-LEFT: medium none; BORDER-BOTTOM: #c0c0c0 1px solid"
height=121 cellSpacing=0 cellPadding=0 width=640>
  <TBODY>
  <TR>
    <TD vAlign=top width="100%"><IMG
      src="img/ru/logo2.jpg" width="640" height="121" border=0 class="conthdr" ></TD>
</TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=640 border=0>
  <TBODY>

  <TD width="100%" height="100%" vAlign=top>
   <DIV><IMG
      src="img/ru/old/articles/articles.png" width="640" height="33"></DIV>


      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=36
            src="img/ru/mtdl.png" width=5></TD>
          <TD class=ntitle vAlign=top
          background="mtdbg.png" height=36> Таблицы переходов.</TD>
          <TD width=5><IMG height=36
            src="img/ru/mtdr.png"
      width=20></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5 background="ltd.gif"></TD>
          <TD class=news vAlign=top><p>Что же такое таблицы переходов? По моему это аналог массивов. Как и к массиву так и к таблице переходов обращение ведется по индексу. В качестве индекса у таблицы переходов выступает переменная, а правильнее сказать ее значение. Разберем принцип создания и работы таблицы переходов. Для создания таблицы переходов используется следующий опкод:


</p>

<div class="mycode5">
  <pre>
0871: init_jump_table <span class="general1-variable">$peremen</span> total_jumps <span class="general1-number">7 0</span> <span class="general1-label">@метка_выхода</span> jumps <span class="general1-number">0</span> <span class="general1-label">@метка1</span> <span class="general1-number">1</span> <span class="general1-label">@метка2</span> <span class="general1-number">2</span> <span class="general1-label">@метка3</span> <span class="general1-number">3</span> <span class="general1-label">@метка4</span><span class="general1-number"> 4</span> <span class="general1-label">@метка5</span> <span class="general1-number">5</span> <span class="general1-label">@метка6</span> <span class="general1-number">6</span> <span class="general1-label">@метка7</span></pre>
</div>
<br>
<p align="left"><strong>total_jumps<span class="general1-number"> 7</span></strong> – общее количество переходов, в нашем случае равно семи. <br>
<span class="general1-variable">$peremen</span> – переменная, по значению которой и будет осуществляться переход на определенную метку. Отсчет ведется с 0. <br>
<strong class="general1-label">@метка_выхода</strong> – выход из таблицы.<br>
  <strong>jumps <span class="general1-number">0</span> <span class="general1-label">@метка1</span> - <span class="general1-number">6</span> <span class="general1-label">@метка7</span></strong> – метки переходов, то есть те метки на которые будет осуществляться переход согласно значению переменной. Цифра <span class="general1-number">0</span> перед меткой<strong class="general1-label"> @метка1</strong> означает то, что если переменная <span class="general1-variable">$peremen</span><span class="style17"> = </span><span class="general1-model">0</span> то будет произведен переход на <strong class="general1-label">метку1</strong> и т.д. </p>
<p align="left">Максимальное количество переходов в строке не может превышать 7. Если же необходимо большее количество переходов, то в<strong> паре с опкодом 0871: используется еще и опкод 0872:</strong> </p>
<div class="mycode5">
  <pre>
0871: init_jump_table <span class="general1-variable">$peremen</span> total_jumps <span class="general1-number">8 0</span> <span class="general1-label">@метка_выхода</span> jumps <span class="general1-number">0</span> <span class="general1-label">@метка1</span> <span class="general1-number">1</span> <span class="general1-label">@метка2</span> <span class="general1-number">2</span> <span class="general1-label">@метка3</span> <span class="general1-number">3</span> <span class="general1-label">@метка4</span> <span class="general1-number">4</span> <span class="general1-label">@метка5</span> <span class="general1-number">5</span> <span class="general1-label">@метка6</span> <span class="general1-number">6</span> <span class="general1-label">@метка7 </span>
0872: jump_table_jumps <span class="general1-number">7</span> <span class="general1-label">@метка8</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span> <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span></pre>
</div>
<br>
<p align="left">Все отсутствующие переходы должны быть заполнены так <span class="general1-number">-1</span> и метка выхода. В нашем случае это выглядит так <span class="general1-number">-1</span> <span class="general1-label">@метка_выхода</span>. Так же они заполняются и в случае если переходов меньше <span class="general1-number">7</span>. <a name="jump_table"></a><br>
<br>Mаксимальное число меток для  одной jump_table, созданной опкодами 0871 и 0872, равно <strong>75</strong>.</p>
<p align="left">Теперь посмотрим как же работает таблица переходов. </p>
<div  class="imgcursor" align="right"><span class="kbd"><img src="img/ru/ico_cb.gif" alt="Copy to Clipboard" width="16" height="16"  onClick="ClipBoard();"  ></span>
<TEXTAREA ID="holdtext" STYLE="display:none;"></TEXTAREA></div>
<div class=mycode5>
<pre id="copytext">
<span class="general1-reservedword">create_thread</span><span class="general1-space"> </span><span class="general1-label">@JumpT
</span><span class="general1-label">

:JumpT
</span><span class="general1-symbol">03A4: name_thread </span><span class="general1-string">'JumpT'
</span><span class="general1-variable">$CHECK</span><span class="general1-symbol">=</span><span class="general1-number">0

</span><span class="general1-label">:JumpT_1
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
04C4: create_coordinate </span><span class="general1-variable">$X</span><span class="general1-space"> </span><span class="general1-variable">$Y</span><span class="general1-space"> </span><span class="general1-variable">$Z</span><span class="general1-space"> from_actor </span><span class="general1-variable">$PLAYER_ACTOR</span><span class="general1-space"> offset </span><span class="general1-number">1.0</span><span class="general1-space"> </span><span class="general1-number">3.0</span><span class="general1-space"> </span><span class="general1-number">0.0</span><span class="general1-space">
 </span><span class="general1-variable">$Z</span><span class="general1-space"> -=</span><span class="general1-number">1.1
</span><span class="general1-reservedword">gosub</span><span class="general1-space"> </span><span class="general1-label">@Jump_table</span><span class="general1-space">
</span><span class="general1-class">actor</span><span class="general1-symbol">.</span><span class="general1-command">Create</span><span class="general1-symbol">(</span><span class="general1-variable">$Actor</span><span class="general1-symbol">,</span><span class="general1-number">7</span><span class="general1-symbol">,</span><span class="general1-variable">$MODEL</span><span class="general1-symbol">,</span><span class="general1-variable">$X</span><span class="general1-symbol">, </span><span class="general1-variable">$Y</span><span class="general1-symbol">, </span><span class="general1-variable">$Z</span><span class="general1-symbol">)
</span><span class="general1-class">actor</span><span class="general1-symbol">.</span><span class="general1-command">Health</span><span class="general1-symbol">(</span><span class="general1-variable">$Actor</span><span class="general1-symbol">)= </span><span class="general1-number">1000</span><span class="general1-space">
07FE: set_actor </span><span class="general1-variable">$Actor</span><span class="general1-space"> fighting_style_to </span><span class="general1-variable">22@</span><span class="general1-space"> </span><span class="general1-number">6
</span><span class="general1-reservedword">if
</span><span class="general1-space"> </span><span class="general1-variable">$CHECK</span><span class="general1-space"> ==</span><span class="general1-number">3 </span>
<span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JumpT_2</span><span class="general1-space">
</span><span class="general1-symbol">01B2: give_actor </span><span class="general1-variable">$Actor</span><span class="general1-space"> weapon </span><span class="general1-number">5</span><span class="general1-space"> ammo </span><span class="general1-number">3000</span><span class="general1-space"> </span><span class="general1-comment">// Load the weapon model before using this </span>
<span class="general1-label">:JumpT_2</span><span class="general1-space">
05E2: actor </span><span class="general1-variable">$Actor</span><span class="general1-space"> kill_actor </span><span class="general1-variable">$PLAYER_ACTOR</span><span class="general1-space">


</span><span class="general1-label">:JumpT_3
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">if
</span><span class="general1-class">actor</span><span class="general1-symbol">.</span><span class="general1-command">Dead</span><span class="general1-symbol">(</span><span class="general1-variable">$Actor</span><span class="general1-symbol">)
</span><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JumpT_3
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">2000</span><span class="general1-space"> ms
</span><span class="general1-class">actor</span><span class="general1-symbol">.</span><span class="general1-command">DestroyInstantly</span><span class="general1-symbol">(</span><span class="general1-variable">$Actor</span><span class="general1-symbol">)
</span><span class="general1-variable">$CHECK</span><span class="general1-space"> +=</span><span class="general1-number">1

</span><span class="general1-label">:JumpT_4
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">if
</span><span class="general1-space"> </span><span class="general1-number">4</span><span class="general1-space"> &gt; </span><span class="general1-variable">$CHECK
</span><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JumpT_5
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">1000</span><span class="general1-space"> ms
</span><span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@JumpT_1

:JumpT_5
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Destroy</span><span class="general1-symbol">(</span><span class="general1-model">#VHMYELV</span><span class="general1-symbol">)
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Destroy</span><span class="general1-symbol">(</span><span class="general1-model">#VWMYBOX</span><span class="general1-symbol">)
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Destroy</span><span class="general1-symbol">(</span><span class="general1-model">#WMYCR</span><span class="general1-symbol">)
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Destroy</span><span class="general1-symbol">(</span><span class="general1-model">#OMYKARA</span><span class="general1-symbol">)
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Destroy</span><span class="general1-symbol">(</span><span class="general1-model">#BAT</span><span class="general1-symbol">)
</span><span class="general1-reservedword">end_thread</span><span class="general1-space">

</span><span class="general1-label">:Jump_table
</span><span class="general1-symbol">0871: init_jump_table </span><span class="general1-variable">$CHECK</span><span class="general1-space"> total_jumps </span><span class="general1-number">4</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT</span><span class="general1-space"> jumps </span><span class="general1-number">0</span><span class="general1-space"> </span><span class="general1-label">@JUMP_0</span><span class="general1-space"> </span><span class="general1-number">1</span><span class="general1-space"> </span><span class="general1-label">@JUMP_1</span><span class="general1-space"> </span><span class="general1-number">2</span><span class="general1-space"> </span><span class="general1-label">@JUMP_2</span><span class="general1-space"> </span><span class="general1-number">3</span><span class="general1-space"> </span><span class="general1-label">@JUMP_3</span><span class="general1-space"> -</span><span class="general1-number">1</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT</span><span class="general1-space"> -</span><span class="general1-number">1</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT</span><span class="general1-space"> -</span><span class="general1-number">1</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT</span><span class="general1-space">

</span><span class="general1-label">:JUMP_0
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Load</span><span class="general1-symbol">(</span><span class="general1-model">#VHMYELV</span><span class="general1-symbol">)
038B: load_requested_models

</span><span class="general1-label">:JUMP_0_1
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">if
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Available</span><span class="general1-symbol">(</span><span class="general1-model">#VHMYELV</span><span class="general1-symbol">)
</span><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JUMP_0_1
</span><span class="general1-symbol">04AE: </span><span class="general1-space"> </span><span class="general1-variable">$MODEL</span><span class="general1-space"> = </span><span class="general1-number">82</span><span class="general1-space">
</span><span class="general1-variable">22@</span><span class="general1-space"> = </span><span class="general1-number">5
</span><span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT

:JUMP_1
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Load</span><span class="general1-symbol">(</span><span class="general1-model">#VWMYBOX</span><span class="general1-symbol">)
038B: load_requested_models

</span><span class="general1-label">:JUMP_1_1
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">if
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Available</span><span class="general1-symbol">(</span><span class="general1-model">#VWMYBOX</span><span class="general1-symbol">)
</span><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JUMP_1_1
</span><span class="general1-symbol">04AE: </span><span class="general1-space"> </span><span class="general1-variable">$MODEL</span><span class="general1-space"> = </span><span class="general1-number">81</span><span class="general1-space">
</span><span class="general1-variable">22@</span><span class="general1-space"> = </span><span class="general1-number">6
</span><span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT

:JUMP_2
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Load</span><span class="general1-symbol">(</span><span class="general1-model">#WMYCR</span><span class="general1-symbol">)
038B: load_requested_models

</span><span class="general1-label">:JUMP_2_1
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">if
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Available</span><span class="general1-symbol">(</span><span class="general1-model">#WMYCR</span><span class="general1-symbol">)
</span><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JUMP_2_1
</span><span class="general1-symbol">04AE: </span><span class="general1-space"> </span><span class="general1-variable">$MODEL</span><span class="general1-space"> = </span><span class="general1-number">100</span><span class="general1-space">
</span><span class="general1-variable">22@</span><span class="general1-space"> = </span><span class="general1-number">7
</span><span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT

:JUMP_3
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Load</span><span class="general1-symbol">(</span><span class="general1-model">#OMYKARA</span><span class="general1-symbol">)
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Load</span><span class="general1-symbol">(</span><span class="general1-model">#BAT</span><span class="general1-symbol">)
038B: load_requested_models

</span><span class="general1-label">:JUMP_3_1
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">if</span><span class="general1-space"> </span><span class="general1-reservedword">and
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Available</span><span class="general1-symbol">(</span><span class="general1-model">#OMYKARA</span><span class="general1-symbol">)
</span><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Available</span><span class="general1-symbol">(</span><span class="general1-model">#BAT</span><span class="general1-symbol">)
</span><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JUMP_3_1
</span><span class="general1-symbol">04AE: <span class="general1-space"> </span><span class="general1-variable">$MODEL</span><span class="general1-space"> = </span><span class="general1-number">203</span><span class="general1-space">
</span><span class="general1-variable">22@</span><span class="general1-space"> = </span><span class="general1-number">8
</span><span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT

:EXIT_JT
</span><span class="general1-reservedword">return</span></span></pre>
</div>

<p align="left">Принцип работы. </p>
<p align="left">Переменная <span class="general1-variable">$CHECK</span><span class="general1-symbol">=</span><span class="general1-number">0</span><br>
Командой <span class="general1-reservedword">gosub</span><span class="general1-space"> </span><span class="general1-label">@Jump_table</span> мы обращаемся к таблице переходов и сразу же производится переход на первую метку, т.е. <span class="general1-label">:JUMP_0
</span>, не забываем что отсчет ведется с <span class="general1-number">0</span>. </p>
<p align="left">Получаем данные, которые там находятся:</p>
<div class="mycode5">
<span class="general1-label">:JUMP_0</span><br>
<span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Load</span><span class="general1-symbol">(</span><span class="general1-model">#VHMYELV</span><span class="general1-symbol">)<br>
038B: load_requested_models

</span><br><br><span class="general1-label">:JUMP_0_1
</span><br><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><br><span class="general1-reservedword">if
</span><br><span class="general1-class">model</span><span class="general1-symbol">.</span><span class="general1-command">Available</span><span class="general1-symbol">(</span><span class="general1-model">#VHMYELV</span><span class="general1-symbol">)
</span><br><span class="general1-reservedword">jf</span><span class="general1-space"> </span><span class="general1-label">@JUMP_0_1
</span><br><span class="general1-symbol">04AE: </span><span class="general1-space"> </span><span class="general1-variable">$MODEL</span><span class="general1-space"> = </span><span class="general1-number">82</span><span class="general1-space">
</span><br><span class="general1-variable">22@</span><span class="general1-space"> = </span><span class="general1-number">5
</span><br><span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@EXIT_JT</span></div>
<p align="left"> и прыгаем на метку выхода.</p>
<div class="mycode5">
<span class="general1-label">

:EXIT_JT</span><br>
<span class="general1-reservedword">return

</span>
</div>
<p>
 Далее возвращаемся на следующую строку после команды <span class="general1-reservedword">gosub</span><span class="general1-space"> </span><span class="general1-label">@Jump_table</span>. <br>
Создаем актера, устанавливаем ему стиль борьбы и  здоровье. Проверяем, равна ли переменная 3 и если равна то даем ему оружие, а в  противном случае сразу идем на метку <span class="general1-label">:JumpT_2</span> и даем команду актеру атаковать игрока. Делаем  проверку умер ли актер и если умер то удаляем его, увеличиваем переменную на  единицу<span class="general1-variable"> $CHECK</span><span class="general1-space"> +=</span><span class="general1-number">1</span>, производим проверку <span class="general1-number">4</span><span class="general1-space"> &gt; </span><span class="general1-variable">$CHECK </span> и если больше то идем  на метку <span class="general1-reservedword">jump</span><span class="general1-space"> </span><span class="general1-label">@JumpT_1</span>. Теперь в таблице переходов будет выбрана метка <span class="general1-space"></span><span class="general1-label">@JUMP_1</span>, поскольку <span class="general1-variable">$CHECK</span><span class="general1-symbol">=</span><span class="general1-number">1</span> и т.д.  </p>


	<p><strong>Смотрите пример<a href="examples/Jump.txt" target="_blank"> здесь</a>.</strong></p></TD>
          <TD width=5
        background="rtd.gif"></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=20
            src="img/ru/mtdlbot.png" width=5 border=0></TD>
          <TD align=left
            background="mtdbgbot.png"></TD>
          <TD class=ninfo align=right
          background="mtdbgbot.png">&nbsp;
            </TD>
          <TD width=5><IMG height=20
            src="img/ru/mtdrbot.png" width=5
        border=0></TD></TR></TBODY></TABLE></DIV>
<BR><BR></TD></TR><td width="100%"></TBODY></TABLE>
</TABLE></body></html>
