<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">

<HTML><HEAD><TITLE>Создание миссии. Часть 2</TITLE>
<link rel="stylesheet" type="text/css" href="../../style/style.css">
<META http-equiv=Content-Type content="text/html; charset=windows-1251">
</HEAD>
<BODY topMargin=0 >
<TABLE
style="BORDER-RIGHT: medium none; BORDER-TOP: medium none; BORDER-LEFT: medium none; BORDER-BOTTOM: #c0c0c0 1px solid"
height=121 cellSpacing=0 cellPadding=0 width=640>
  <TBODY>
  <TR>
    <TD vAlign=top width="100%"><IMG
      src="img/ru/logo2.jpg" width="640" height="121" border=0 class="conthdr" ></TD>
  </TR></TBODY></TABLE>
<TABLE cellSpacing=0 cellPadding=0 width=640 border=0>
  <TBODY>

  <TD width="640" height="100%" vAlign=top>
   <DIV><IMG
      src="img/ru/old/articles/articles.png" width="640" height="33"></DIV>


      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=36
            src="img/ru/mtdl.png" width=5></TD>
          <TD class=ntitle vAlign=top
          background="mtdbg.png" height=36> Создание миссии. Часть 2 </TD>
          <TD width=5><IMG height=36
            src="img/ru/mtdr.png"
      width=20></TD></TR></TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5 background="ltd.gif"></TD>
          <TD class=news vAlign=top>
 [продолжение.  <a href="articles10.htm">начало читайте здесь </a>] <br>
 <br>
Для запуска миссии требуется особый блок кода, именуемый триггером. По своей сути это набор различных условий, который должны выполняться для того, чтобы миссия началась. В оригинальной игре такими условиями чаще всего являются нахождение игрока в определенном месте (там обычно создается маркер), управление определенным типом машины (скорая, пожарка), а также ряд общих условий (проверка состояния игрока). <br>
<br>
Триггер представляет собой отдельный поток, активируемый либо после прохождения определенной миссии, либо в начале новой игры. <br>
<br>
Для начала необходимо объявить миссию в заголовке файла. Перейдите на строку DEFINE MISSIONS 0 и измените число на 1. После этого на следующей строке напишите: <br>
<br>
<div class="mycode5">
DEFINE MISSION <span class="general1-number">0</span> at <span class="general1-label">@MyMission </span></div>
<br>
Теперь заголовок файла выглядит как <br>
<br>
<div class="mycode5">
DEFINE OBJECTS <span class="general1-number">0</span> <br>
DEFINE MISSIONS <span class="general1-number">1</span> <br>
DEFINE MISSION <span class="general1-number">0</span> at <span class="general1-label">@MyMission</span> <br>
DEFINE EXTERNAL_SCRIPTS <span class="general1-number">-1</span> <span class="general1-comment">// Use -1 to not write AAA script </span><br>
DEFINE UNKNOWN_EMPTY_SEGMENT<span class="general1-number"> 0</span> <br>
DEFINE UNKNOWN_THREADS_MEMORY <span class="general1-number">0 </span></div>
<br>
Теперь добавим триггер. Найдите в файле комментарий <span class="general1-comment">// put your mission mods here</span> и вставьте после него следующий код: <br>
<br>
<div class="mycode5"><pre >
<span class="general1-label">:MyTrigger </span><br>
<span class="general1-reservedword">thread</span> <span class="general1-string">"MyTrigger" </span><br><span class="general1-variable">$TrigMarker</span> = <span class="general1-class">Marker</span>.<span class="general1-command">CreateIconAndSphere</span>(<span class="general1-number">15</span>, <span class="general1-number">2489.0591</span>, <span class="general1-number">-1682.2808</span>, <span class="general1-number">13.3358</span>) <br><span class="general1-reservedword">while</span> <span class="general1-variable">$MyMission_Passed</span> == <span class="general1-number">0</span> <br><span class="general1-reservedword">wait</span> <span class="general1-number">250</span> <br><span class="general1-reservedword">if</span> <span class="general1-class">Player</span>.<span class="general1-command">Defined</span>(<span class="general1-variable">$PLAYER_CHAR</span>) <br> <span class="general1-reservedword"> then </span>
    <span class="general1-reservedword">if</span> <span class="general1-variable">$ONMISSION</span> == <span class="general1-number">0</span> <span class="general1-comment">// integer values </span><br>     <span class="general1-reservedword">then </span><br>       <span class="general1-reservedword">if</span> 00FF: actor <span class="general1-variable">$PLAYER_ACTOR</span> <span class="general1-number">0 2489.0591 -1682.2808 13.3358</span> radius <span class="general1-number">1.0 1.0 2.0 </span><br>        <span class="general1-reservedword">then </span><br>          <span class="general1-reservedword">if</span> <span class="general1-class">Player</span>.<span class="general1-command">Controllable</span>(<span class="general1-variable">$PLAYER_CHAR</span>) <br>           <span class="general1-reservedword">then</span> <br>          <span class="general1-variable">$ONMISSION</span> = <span class="general1-number">1</span> <span class="general1-comment">// integer values </span><br>          00BA: text_styled <span class="general1-string">'INTRO_1'</span> <span class="general1-number">1000</span> ms<span class="general1-number"> 2</span> <span class="general1-comment">// Big Smoke </span><br>          <span class="general1-class">Marker</span>.<span class="general1-command">Disable</span>(<span class="general1-variable">$TrigMarker</span>) <br>          <span class="general1-reservedword">start_mission</span> MyMission <br>          <span class="general1-reservedword">end</span> <span class="general1-comment">// if1 </span><br>       <span class="general1-reservedword">end</span> <span class="general1-comment">// if2 </span><br>     <span class="general1-reservedword">end</span> <span class="general1-comment">// if3 </span><br>  <span class="general1-reservedword">end</span> <span class="general1-comment">// if4 </span><br><span class="general1-reservedword">end</span><span class="general1-comment">// while</span> <br><span class="general1-reservedword">end_thread </span></pre>
</div>
<br>
Это и есть наш триггер, который запустит миссию. <br>
Как видите в начале создается маркер (рядом с домом CJ'я). После этого запускается цикл While, который проверяет специальную переменную <span class="var3">$MyMission_Passed</span>. Она обозначает статус прохождения миссии: когда миссия будет пройдена, мы установим переменную равной 1, цикл перестанет работать и выполнится команда end_thread. Работа триггера будет окончена. <br>
В теле цикла мы последовательно проверяем 4 условия: <br>
1. Игрок должен быть активен (не пойманным, не утонувшим). <br>
2. Не должна быть запущена другая миссия. За это отвечает переменная <span class="var3">$ONMISSION</span>. Когда запускается миссия, она становится равной 1, и другие миссии быть запущены не могут. <br>
3. Игрок должен находиться в определенном месте (где мы создали маркер). <br>
4. Игрок должен быть управляемым. <br>
<br>
Если все эти условия выполняются, то мы <br>
1. Устанавливаем флаг миссии (<span class="var3">$ONMISSION</span> = <span class="var1">1</span>) <br>
2. Выводим текст. Здесь может быть любое значение. <br>
3. Отключаем маркер. <br>
4. Начинаем миссию (<span class="codes">start_mission</span> <span class="general1-label">MyMission</span>). Здесь можно написать <span class="codes">start_mission</span> <span class="var1">0</span>. Эти варианты равнозначны. <br>
<br>
Естественно, что вы можете добавлять свои условия. Например можно сделать проверку, чтобы у игрока было больше 1000 долларов на счету. Для этого нужно добавить следующие строки: <br>
<br>
<div class="mycode5"><pre >
<span class="general1-reservedword">if</span> <span class="general1-class">Player</span>.<span class="general1-command">Defined</span>(<span class="general1-variable">$PLAYER_CHAR</span>) <br> <span class="general1-reservedword"> then </span><br>    <span class="general1-reservedword">if</span> <span class="general1-variable">$ONMISSION</span> == <span class="general1-number">0</span> <span class="general1-comment">// integer values </span><br>     <span class="general1-reservedword">then </span><br>       <span class="general1-reservedword">if</span> 00FF: actor <span class="general1-variable">$PLAYER_ACTOR</span> <span class="general1-number">0 2489.0591 -1682.2808 13.3358</span> radius <span class="general1-number">1.0 1.0 2.0</span> <br>        <span class="general1-reservedword">then</span> <br>          <span class="general1-reservedword">if</span> <span class="general1-class">Player</span>.<span class="general1-command">Controllable</span>(<span class="general1-variable">$PLAYER_CHAR</span>) <br>           <span class="general1-reservedword">then </span><br>             <span class="general1-reservedword">if</span> <span class="general1-class">Player</span>.<span class="general1-command">Money</span>(<span class="general1-variable">$PLAYER_CHAR</span>) &gt; <span class="general1-number">1000</span> <br>              <span class="general1-reservedword">then </span><br>              <span class="general1-variable">$ONMISSION</span> = <span class="general1-number">1</span> <span class="general1-comment">// integer values </span><br>              00BA: text_styled <span class="general1-string">'INTRO_1'</span> <span class="general1-number">1000</span> ms<span class="general1-number"> 2</span> <span class="general1-comment">// Big Smoke </span><br>              <span class="general1-class">Marker</span>.<span class="general1-command">Disable</span>(<span class="general1-variable">$TrigMarker</span>)<br>              <span class="general1-reservedword">start_mission</span> MyMission <br>            <span class="general1-reservedword">end</span><br>        <span class="general1-reservedword">end</span><span class="general1-comment"> // if1 </span><br>     <span class="general1-reservedword"> end </span><span class="general1-comment">// if2 </span><br>  <span class="general1-reservedword"> end </span><span class="general1-comment">// if3 </span><br><span class="general1-reservedword">end</span><span class="general1-comment"> // if4</span></pre>
  </div>
<br>
Чтобы триггер заработал, нужно добавить команду create_thread. Найдите комментарий <span class="general1-comment">// put your create_thread commands here</span> и вставьте после него строку <br>
<br>
<div class="mycode5">
<span class="general1-reservedword">create_thread</span> <span class="general1-label">@MyTrigger</span> </div>
<br>
Теперь файл stripped.txt должен выглядеть так <br>
<br>
<div class="mycode5">
<pre >
<span class="general1-symbol">DEFINE OBJECTS </span><span class="general1-number">0</span><span class="general1-space">
DEFINE MISSIONS </span><span class="general1-number">1</span><span class="general1-space">
DEFINE MISSION </span><span class="general1-number">0</span><span class="general1-space"> at </span><span class="general1-label">@MyMission</span><span class="general1-space">
DEFINE EXTERNAL_SCRIPTS -</span><span class="general1-number">1</span><span class="general1-space"> </span><span class="general1-comment">// Use -1 to not write AAA script
</span><span class="general1-symbol">DEFINE UNKNOWN_EMPTY_SEGMENT </span><span class="general1-number">0</span><span class="general1-space">
DEFINE UNKNOWN_THREADS_MEMORY </span><span class="general1-number">0</span><span class="general1-space">

</span><span class="general1-comment">// --------------------
// THE STRIPPED MAIN THREAD
// contains initial info
// --------------------
</span><span class="general1-reservedword">thread</span><span class="general1-space"> </span><span class="general1-string">'Main'</span><span class="general1-space">
</span><span class="general1-reservedword">var</span><span class="general1-space">
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">: Player
</span><span class="general1-reservedword">end</span><span class="general1-space"> </span><span class="general1-comment">// var
</span><span class="general1-symbol">01F0: set_max_wanted_level_to </span><span class="general1-number">6</span><span class="general1-space">
</span><span class="general1-reservedword">set_wb_check_to</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space">
00C0: set_current_time </span><span class="general1-number">8</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space">
04E4: unknown_refresh_game_renderer_at </span><span class="general1-number">2488.5601</span><span class="general1-space"> -</span><span class="general1-number">1666.84</span><span class="general1-space">
</span><span class="general1-class">Camera</span><span class="general1-symbol">.</span><span class="general1-command">SetAtPos</span><span class="general1-symbol">(</span><span class="general1-number">2488.5601</span><span class="general1-symbol">, -</span><span class="general1-number">1666.84</span><span class="general1-symbol">, </span><span class="general1-number">13.38</span><span class="general1-symbol">)
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-space"> = </span><span class="general1-class">Player</span><span class="general1-symbol">.</span><span class="general1-command">Create</span><span class="general1-symbol">(</span><span class="general1-model">#NULL</span><span class="general1-symbol">, </span><span class="general1-number">2488.5601</span><span class="general1-symbol">, -</span><span class="general1-number">1666.84</span><span class="general1-symbol">, </span><span class="general1-number">13.38</span><span class="general1-symbol">)
</span><span class="general1-variable">$PLAYER_ACTOR</span><span class="general1-space"> = </span><span class="general1-class">Actor</span><span class="general1-symbol">.</span><span class="general1-command">EmulateFromPlayer</span><span class="general1-symbol">(</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">)
</span><span class="general1-class">Camera</span><span class="general1-symbol">.</span><span class="general1-command">SetBehindPlayer</span><span class="general1-space">
</span><span class="general1-reservedword">set_weather</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space">
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">.</span><span class="general1-command">SetClothes</span><span class="general1-symbol">(</span><span class="general1-string">&quot;PLAYER_FACE&quot;</span><span class="general1-symbol">, </span><span class="general1-string">&quot;HEAD&quot;</span><span class="general1-symbol">, Head)
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">.</span><span class="general1-command">SetClothes</span><span class="general1-symbol">(</span><span class="general1-string">&quot;JEANSDENIM&quot;</span><span class="general1-symbol">, </span><span class="general1-string">&quot;JEANS&quot;</span><span class="general1-symbol">, Legs)
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">.</span><span class="general1-command">SetClothes</span><span class="general1-symbol">(</span><span class="general1-string">&quot;SNEAKERBINCBLK&quot;</span><span class="general1-symbol">, </span><span class="general1-string">&quot;SNEAKER&quot;</span><span class="general1-symbol">, Shoes)
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">.</span><span class="general1-command">SetClothes</span><span class="general1-symbol">(</span><span class="general1-string">&quot;VEST&quot;</span><span class="general1-symbol">, </span><span class="general1-string">&quot;VEST&quot;</span><span class="general1-symbol">, Torso)
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">.</span><span class="general1-command">Build</span><span class="general1-space">
</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">.</span><span class="general1-command">CanMove</span><span class="general1-space"> = </span><span class="general1-reservedword">True</span><span class="general1-space">
</span><span class="general1-reservedword">fade</span><span class="general1-space"> </span><span class="general1-number">1</span><span class="general1-space"> (out) </span><span class="general1-number">0</span><span class="general1-space"> ms
</span><span class="general1-reservedword">select_interior</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space">
0629: change_stat </span><span class="general1-number">181</span><span class="general1-space"> (islands unlocked) </span><span class="general1-reservedword">to</span><span class="general1-space"> </span><span class="general1-number">4</span><span class="general1-space">
016C: restart_if_wasted at </span><span class="general1-number">2027.77</span><span class="general1-space"> -</span><span class="general1-number">1420.52</span><span class="general1-space"> </span><span class="general1-number">15.99</span><span class="general1-space"> angle </span><span class="general1-number">137.0</span><span class="general1-space"> </span><span class="general1-reservedword">unknown</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space">
016D: restart_if_busted at </span><span class="general1-number">1550.68</span><span class="general1-space"> -</span><span class="general1-number">1675.49</span><span class="general1-space"> </span><span class="general1-number">14.51</span><span class="general1-space"> angle </span><span class="general1-number">90.0</span><span class="general1-space"> </span><span class="general1-reservedword">unknown</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space">
</span><span class="general1-comment">// put your create_thread commands here

</span><span class="general1-reservedword">create_thread</span><span class="general1-space"> </span><span class="general1-label">@MyTrigger</span><span class="general1-space">
</span><span class="general1-reservedword">end_thread</span><span class="general1-space">

</span><span class="general1-comment">// put your mission mods here

</span><span class="general1-label">:MyTrigger</span><span class="general1-space">
</span><span class="general1-reservedword">thread</span><span class="general1-space"> </span><span class="general1-string">&quot;MyTrigger&quot;</span><span class="general1-space">
</span><span class="general1-variable">$TrigMarker</span><span class="general1-space"> = </span><span class="general1-class">Marker</span><span class="general1-symbol">.</span><span class="general1-command">CreateIconAndSphere</span><span class="general1-symbol">(</span><span class="general1-number">15</span><span class="general1-symbol">, </span><span class="general1-number">2489.0591</span><span class="general1-symbol">, -</span><span class="general1-number">1682.2808</span><span class="general1-symbol">, </span><span class="general1-number">13.3358</span><span class="general1-symbol">)
</span><span class="general1-reservedword">while</span><span class="general1-space"> </span><span class="general1-variable">$MyMission_Passed</span><span class="general1-space"> == </span><span class="general1-number">0</span><span class="general1-space">
</span><span class="general1-reservedword">wait</span><span class="general1-space"> </span><span class="general1-number">250</span><span class="general1-space">
</span><span class="general1-reservedword">if</span><span class="general1-space"> </span><span class="general1-class">Player</span><span class="general1-symbol">.</span><span class="general1-command">Defined</span><span class="general1-symbol">(</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">)
</span><span class="general1-reservedword">  then</span><span class="general1-space">
</span><span class="general1-reservedword">    if</span><span class="general1-space"> </span><span class="general1-variable">$ONMISSION</span><span class="general1-space"> == </span><span class="general1-number">0</span><span class="general1-space"> </span><span class="general1-comment">// integer values
</span><span class="general1-reservedword">     then</span><span class="general1-space">
</span><span class="general1-reservedword">       if</span><span class="general1-space"> 00FF: actor </span><span class="general1-variable">$PLAYER_ACTOR</span><span class="general1-space"> </span><span class="general1-number">0</span><span class="general1-space"> </span><span class="general1-number">2489.0591</span><span class="general1-space"> -</span><span class="general1-number">1682.2808</span><span class="general1-space"> </span><span class="general1-number">13.3358</span><span class="general1-space"> radius </span><span class="general1-number">1.0</span><span class="general1-space"> </span><span class="general1-number">1.0</span><span class="general1-space"> </span><span class="general1-number">2.0</span><span class="general1-space">
</span><span class="general1-reservedword">        then</span><span class="general1-space">
</span><span class="general1-reservedword">          if</span><span class="general1-space"> </span><span class="general1-class">Player</span><span class="general1-symbol">.</span><span class="general1-command">Controllable</span><span class="general1-symbol">(</span><span class="general1-variable">$PLAYER_CHAR</span><span class="general1-symbol">)
</span><span class="general1-reservedword">           then</span><span class="general1-space">
</span><span class="general1-variable">        $ONMISSION</span><span class="general1-space"> = </span><span class="general1-number">1</span><span class="general1-space"> </span><span class="general1-comment">// integer values
</span><span class="general1-symbol">        00BA: text_styled </span><span class="general1-string">'INTRO_1'</span><span class="general1-space"> </span><span class="general1-number">1000</span><span class="general1-space"> ms </span><span class="general1-number">2</span><span class="general1-space"> </span><span class="general1-comment">// Big Smoke
</span><span class="general1-class">        Marker</span><span class="general1-symbol">.</span><span class="general1-command">Disable</span><span class="general1-symbol">(</span><span class="general1-variable">$TrigMarker</span><span class="general1-symbol">)
</span><span class="general1-reservedword">           start_mission</span><span class="general1-space"> MyMission
</span><span class="general1-reservedword">          end</span><span class="general1-space"> </span><span class="general1-comment">// if1
</span><span class="general1-reservedword">       end</span><span class="general1-space"> </span><span class="general1-comment">// if2
</span><span class="general1-reservedword">    end</span><span class="general1-space"> </span><span class="general1-comment">// if3
</span><span class="general1-reservedword">  end</span><span class="general1-space"> </span><span class="general1-comment">// if4
</span><span class="general1-reservedword">end</span><span class="general1-space"> </span><span class="general1-comment">// while
</span><span class="general1-reservedword">end_thread</span></pre>
</div>
<br>
Теперь добавим саму миссию. Любая миссия (за отдельными исключениями) имеет определенную структуру. У нее есть блок запуска, блок успешного прохождения, блок провала и блок очистки. Заголовок миссии выглядит так: <br>
<br>
<div class="mycode5">
<span class="general1-reservedword">thread</span> <span class="general1-string">"MyMission" </span><br>
<span class="general1-reservedword">gosub</span> <span class="general1-label">@MissionStart </span><br>
<span class="general1-reservedword">if <br>
&nbsp;&nbsp;wasted_or_busted <br>
&nbsp;then <br>
&nbsp;&nbsp;gosub</span> <span class="general1-label">@MissionFailed</span> <br>
<span class="general1-reservedword">end <br>
gosub</span> <span class="general1-label">@MissionCleanup </span><br>
<span class="general1-reservedword">end_thread </span></div>
<br>
Как видите, само тело миссии (после метки <span class="general1-label">MissionStart</span>) представляет собой gosub. Поэтому в конце миссии обязательно нужно вставить return, а не <span class="codes">end_thread</span>. Блок <span class="general1-label">MissionFailed</span> срабатывает, когда игрок умирает или его ловят. <span class="codes">MissionCleanup</span> выполняется всегда в конце миссии, независимо от ее успешности. <br>
Добавим макет миссии в нашу заготовку <br>
<br>
<div class="mycode5">
<span class="general1-label">:MyMission </span><br>
<span class="general1-reservedword">thread</span> <span class="general1-string">"MyMission" </span><br>
<span class="general1-reservedword">gosub</span> <span class="general1-label">@MissionStart </span><br>
<span class="general1-reservedword">if <br>
&nbsp;&nbsp;wasted_or_busted <br>
&nbsp;then <br>
&nbsp;&nbsp;gosub</span> <span class="general1-label">@MissionFailed </span><br>
<span class="general1-reservedword">end <br>
gosub</span> <span class="general1-label">@MissionCleanup </span><br>
<span class="general1-reservedword">end_thread </span><br>
<br>
<span class="general1-label">:MissionStart </span><br>
<span class="general1-comment">&lt;тело миссии&gt;</span> <br>
<span class="general1-reservedword">return</span> <br>
<br>
<span class="general1-label">:MissionFailed</span> <br>
00BA: text_styled <span class="general1-string">'M_FAIL'</span> <span class="general1-number">5000</span> ms <span class="general1-number">1</span> <span class="general1-comment">// ~r~MISSION FAILED! </span><br>
<span class="general1-reservedword">return </span><br>
<br>
<span class="general1-label">:MissionCleanup</span> <br>
<span class="general1-variable">$ONMISSION</span> = <span class="general1-number">0</span> <span class="general1-comment">// integer values</span> <br>
<span class="general1-reservedword">mission_cleanup <br>
return </span></div>
<br>
Это уже полностью рабочая миссия, которая правда только запускается и сразу же заканчивается, поскольку ее тело состоит из одно команды return. <br>
Давайте добавим блок успешного выполнения миссии. Для этого после строки <span class="codes">MissionStart</span> добавьте команду <br>
<br>
<div class="mycode5">
<span class="general1-reservedword">gosub</span> <span class="general1-label">@MissionPassed</span> </div>
<br>
а после слова return следующий код: <br>
<br>
<div class="mycode5">
<span class="general1-label">:MissionPassed</span> <br>
01E3: text_1number_styled <span class="general1-string">'M_PASSD'</span> <span class="general1-number">0 5000</span> ms <span class="general1-number">1</span> <span class="general1-comment">// MISSION PASSED!</span> <br>
<span class="general1-variable">$MyMission_Passed</span> = <span class="general1-number">1</span> <br>
<span class="general1-reservedword">return </span></div>
<br>
теперь миссия выглядит так <br>
<br>
<div class="mycode5">
<span class="general1-label">:MyMission</span> <br>
<span class="general1-reservedword">thread</span> <span class="general1-string">"MyMission"</span> <br>
<span class="general1-reservedword">gosub</span> <span class="general1-label">@MissionStart </span><br>
<span class="general1-reservedword">if <br>
&nbsp;&nbsp;wasted_or_busted <br>
&nbsp;then <br>
&nbsp;&nbsp;gosub</span> <span class="general1-label">@MissionFailed</span> <br>
<span class="general1-reservedword">end <br>
gosub</span> <span class="general1-label">@MissionCleanup </span><br>
<span class="general1-reservedword">end_thread </span><br>
<br>
<span class="general1-label">:MissionStart</span> <br>
<span class="general1-reservedword">gosub</span> <span class="general1-label">@MissionPassed </span><br>
<span class="general1-reservedword">return</span> <br>
<br>
<span class="general1-label">:MissionPassed </span><br>
01E3: text_1number_styled <span class="general1-string">'M_PASSD'</span> <span class="general1-number">0 5000</span> ms <span class="general1-number">1</span> <span class="general1-comment">// MISSION PASSED!</span> <br>
<span class="general1-variable">$MyMission_Passed</span> = <span class="general1-number">1</span> <br>
<span class="general1-reservedword">return </span><br>
<br>
<span class="general1-label">:MissionFailed</span> <br>
00BA: text_styled <span class="general1-string">'M_FAIL'</span> <span class="general1-number">5000</span> ms <span class="general1-number">1</span> <span class="general1-comment">// ~r~MISSION FAILED! </span><br>
<span class="general1-reservedword">return</span> <br>
<br>
<span class="general1-label">:MissionCleanup</span> <br>
<span class="general1-variable">$ONMISSION</span> = <span class="general1-number">0</span> <span class="general1-comment">// integer values</span> <br>
<span class="general1-reservedword">mission_cleanup <br>
return </span></div>
<br>
Скомпилируйте файл (F7), начните новую игру. Можете проверить новую миссию на работоспособность. <br>
Казалось бы все хорошо, но нашему коду не хватает еще одной важной детали. Для того чтобы игра могла корректно завершать миссию в случае смерти игрока, одной переменной <span class="var3">$ONMISSION</span> недостаточно. Нужно связать эту переменную с флагом состояния миссии, чтобы игра поняла, что от изменения именно этой переменной зависит запуск миссий. Это делается командой <br>
<br>
<div class="mycode5">
0180: set_on_mission_flag_to <span class="general1-variable">$ONMISSION </span></div>
<br>
Вставьте ее в начале файла, перед командой <strong>create_thread</strong>. Теперь игра будет корректно завершать миссию в случае провала. <br>
<p><strong>Смотрите пример первой миссии <a href="examples/MyMission.txt" target="_blank">здесь</a>.</strong><br>
</p>            </TD>
          <TD width=5
        background="rtd.gif"></TD></TR>
        </TBODY></TABLE>
      <TABLE cellSpacing=0 cellPadding=0 width="100%">
        <TBODY>
        <TR>
          <TD width=5><IMG height=20
            src="img/ru/mtdlbot.png" width=5 border=0></TD>
          <TD align=left
            background="mtdbgbot.png"></TD>
          <TD class=ninfo align=right
          background="mtdbgbot.png">&nbsp;
            </TD>
          <TD width=5><IMG height=20
            src="img/ru/mtdrbot.png" width=5
        border=0></TD></TR></TBODY></TABLE></DIV>
<BR><BR></TD></TR><td width="640"></TBODY></TABLE>
</TABLE></body></html>
